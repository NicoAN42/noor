<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Dashboard Karyawan</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container mt-5">
    <h2 class="text-primary">Dashboard Karyawan</h2>

    <form method="POST" class="row g-2 mb-4">
      <div class="col-md-5">
        <input type="text" name="nama" class="form-control" placeholder="Nama Nasabah" required>
      </div>
      <div class="col-md-4">
        <input type="date" name="tgl_lahir" class="form-control" placeholder="Tanggal Lahir">
      </div>
      <div class="col-md-3">
        <button type="submit" class="btn btn-primary w-100">Cari Nasabah</button>
      </div>
    </form>

    {% if hasil_pencarian %}
      <h4 class="mt-4">Hasil Pencarian Nasabah:</h4>
      <div class="row">
        {% for nasabah in hasil_pencarian %}
          <div class="col-md-4 mb-4">
            <div class="card shadow border-primary">
              <div class="card-body">
                <h5 class="card-title text-primary">{{ nasabah.nama }}</h5>
                <p class="card-text">
                  <strong>Tgl Lahir:</strong> {{ nasabah.tgl_lahir }}<br>
                  <strong>No HP:</strong> {{ nasabah.no_hp }}<br>
                  <strong>Alamat:</strong> {{ nasabah.alamat }}<br>
                  <strong>Produk Dimiliki:</strong>
                  {% if nasabah.produk %}
                    <ul>
                      {% for p in nasabah.produk %}
                        <li>{{ p }}</li>
                      {% endfor %}
                    </ul>
                  {% else %}
                    <em>Belum memiliki produk</em>
                  {% endif %}
                </p>
                <a href="{{ url_for('profil_nasabah', nasabah_id=nasabah.id) }}" class="btn btn-outline-primary btn-sm">Lihat Profil</a>
                <a href="{{ url_for('tambah_referral', nasabah_id=nasabah.id) }}" class="btn btn-primary btn-sm">Tambah Referral</a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      
    {% elif pencarian_dilakukan %}
      <div class="alert alert-warning mt-4">
        Nasabah tidak ditemukan. <a href="#" data-bs-toggle="modal" data-bs-target="#addNasabahModal">Tambah nasabah baru?</a>
      </div>
    {% endif %}

    {% if nasabah_not_found %}
    <script>
      document.addEventListener("DOMContentLoaded", function() {
        var addModal = new bootstrap.Modal(document.getElementById('addNasabahModal'));
        addModal.show();
      });
    </script>
    {% endif %}

    

    <!-- Modal Tambah Nasabah Baru -->
    <div class="modal fade" id="addNasabahModal" tabindex="-1" aria-labelledby="addNasabahModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <form method="POST" action="{{ url_for('tambah_nasabah') }}">
          <div class="modal-content">
            <div class="modal-header bg-primary text-white">
              <h5 class="modal-title">Tambah Nasabah & Referral</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
            </div>
            <div class="modal-body">
              <div class="mb-2">
                <label>Nama</label>
                <input type="text" name="nama" class="form-control" required>
              </div>
              <div class="mb-2">
                <label>Tanggal Lahir</label>
                <input type="date" name="tgl_lahir" class="form-control" required>
              </div>
              <div class="mb-2">
                <label>No HP</label>
                <input type="text" name="no_hp" class="form-control" required>
              </div>
              <div class="mb-2">
                <label>Alamat</label>
                <textarea name="alamat" class="form-control" required></textarea>
              </div>
              <div class="mb-2">
                <label>Produk Dimiliki</label><br>
                {% for produk in produk_list %}
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="checkbox" name="produk" value="{{ produk }}">
                    <label class="form-check-label">{{ produk }}</label>
                  </div>
                {% endfor %}
              </div>
              <div class="mb-2">
                <label>Produk Direferensikan</label>
                <select name="produk_direferensikan" class="form-select" required>
                  <option value="">-- Pilih Produk --</option>
                  {% for produk in produk_list %}
                    <option value="{{ produk }}">{{ produk }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="mb-2">
                <label>Keterangan Referral</label>
                <textarea name="keterangan" class="form-control" required></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button type="submit" class="btn btn-primary">Simpan</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
            </div>
          </div>
        </form>
      </div>
    </div>


  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
